{% extends "user/base-layout.html" %}
{% load static %}

{% block content %}
<!-- ...:::: Start Breadcrumb Section:::... -->
<div class="breadcrumb-section breadcrumb-bg-color--golden">
    <div class="breadcrumb-wrapper">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h3 class="breadcrumb-title">checkout</h3>
                    <div class="breadcrumb-nav breadcrumb-nav-color--black breadcrumb-nav-hover-color--golden">
                        <nav aria-label="breadcrumb">
                            <ul>
                                <li><a href="index.html">Home</a></li>
                                <li><a href="shop-grid-sidebar-left.html">Shop</a></li>
                                <li class="active" aria-current="page">checkout</li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- ...:::: End Breadcrumb Section:::... -->
<!-- ...:::: Start Account Dashboard Section:::... -->
<div class="account-dashboard mb-3">
    <div class="container">
        <div class="row">
            <div class="col-sm-12 col-md-9 col-lg-8">
                <div class="tab-content dashboard_content " data-aos="fade-up" data-aos-delay="200">
                    {% include 'user/checkout/login.html' %}
                    {% include 'user/checkout/delivery-address.html' %}
                    {% include 'user/checkout/order-summery.html' %}
                    {% include 'user/order/payment.html' %}
                    

                </div>
            </div>

            <div class="col-sm-12 col-md-3 col-lg-4">
                <!-- Tab panes -->
                <div class="tab-content dashboard_content border p-2" id="totels_section" data-aos="fade-up"
                    data-aos-delay="200">
                    <div id="all-checkout-totel-and-order-totel">
                        {% if order.coupen_active == True %}
                        {% include 'user/order/order-totel.html' %}
                        {% else %}
                        {% include 'user/checkout/checkout-totel.html' %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- ...:::: End Account Dashboard Section:::... -->
{% endblock %}

{% block script %}

<script>
    function login_Change() {
        document.getElementById('login_check').style.display = 'none';
        document.getElementById('login_Change').style.display = 'none';
        var login = document.getElementsByClassName('checkout_login');
        for (var i = 0; i < login.length; i++) {
            login[i].style.display = 'block';
        }
    }
    function Continue_Checkout() {
        document.getElementById('login_check').style.display = 'block';
        document.getElementById('login_Change').style.display = 'block';
        var login = document.getElementsByClassName('checkout_login');
        for (var i = 0; i < login.length; i++) {
            login[i].style.display = 'none';
        }
        document.getElementById('checkout_address').style.display = 'block';
    }

    function check_checkout_address(id) {
        // var check_checkout_address = $(".check_checkout_address:checked").val();
        var delivery_address_btn = document.getElementsByClassName('delivery_address_btn');
        for (var i = 0; i < delivery_address_btn.length; i++) {
            delivery_address_btn[i].style.display = 'none';
        }
        document.getElementById('delivery_address_btn-' + id).style.display = 'block'
        document.getElementById('add_new_checkout_address_form').style.display = 'none'
        document.getElementById('add_new_checkout_address_btn_link').style.display = 'block'

    }

    function check_checkout_address_check_Change() {
        document.getElementById('checkout_address').style.display = 'block';
    }

    function delivery_address(id) {
        $.ajax({
            type: "POST",
            url: "{% url 'cart:delivery_address' %}",
            data: {
                id,
                csrfmiddlewaretoken: '{{ csrf_token }}',
                dataType: "json",
            },
            beforeSend: function () {
            },
            success: function (res) {
                $("#checkout_delivery_address").html(res.data);
                document.getElementById('checkout_items_list_order_summry').style.display = 'block';
                document.getElementById('check_checkout_address_check').style.display = 'block';
                document.getElementById('check_checkout_address_check_Change').style.display = 'block';
                document.getElementById('checkout_address').style.display = 'none';
            },
            failure: function () {
            }
        });
    }

    function edit_checkout(id) {

        var edit_checkout_address = document.getElementsByClassName('edit_checkout_address');
        for (var i = 0; i < edit_checkout_address.length; i++) {
            edit_checkout_address[i].style.display = 'none';
        }
        document.getElementById('edit_checkout_address-' + id).style.display = 'block'

        var list_checkout_address = document.getElementsByClassName('list_checkout_address');
        for (var i = 0; i < list_checkout_address.length; i++) {
            list_checkout_address[i].style.display = 'block';
        }
        document.getElementById('list_checkout_address-' + id).style.display = 'none'
        var delivery_address_btn = document.getElementsByClassName('delivery_address_btn');
        for (var i = 0; i < delivery_address_btn.length; i++) {
            delivery_address_btn[i].style.display = 'none';
        }
    }

    function checkout_edit_cencel_address(id) {
        document.getElementById('edit_checkout_address-' + id).style.display = 'none'
        document.getElementById('list_checkout_address-' + id).style.display = 'block'
    }

    function edit_checkout_address_form(id) {
        var name = $('#address_name-' + id).val();
        var phone_no = $('#address_phone_no-' + id).val();
        var pincode = $('#address_pincode-' + id).val();
        var locality = $('#address_locality-' + id).val();
        var address = $('#address_address-' + id).val();
        var city_district_town = $('#address_city_district_town-' + id).val();
        var state = $('#address_state-' + id + ' option:selected').val();
        var landmark = $('#address_landmark-' + id).val();
        var alt_phone_no = $('#address_alt_phone_no-' + id).val();
        var address_type = $(".edit_addresstype-" + id + ":checked").val();

        $.ajax({
            type: "POST",
            url: "{% url 'cart:edit_checkout_address' %}",
            data: {
                id,
                name,
                phone_no,
                pincode,
                locality,
                address,
                city_district_town,
                state,
                landmark,
                alt_phone_no,
                address_type,
                csrfmiddlewaretoken: '{{ csrf_token }}',
                dataType: "json",

            },
            beforeSend: function () {
                document.getElementById('submit_checkout_edit_address-' + id).setAttribute('disabled', '')
            },
            success: function (res) {
                $('#checkout_address').html(res.template);
                document.getElementById('submit_checkout_edit_address-' + id).removeAttribute('disabled')
                Swal.fire({
                    position: 'top-end',
                    icon: 'success',
                    title: 'Your address has been saved',
                    showConfirmButton: false,
                    timer: 1500
                })
            },
            failure: function () {
                Swal.fire({
                    position: 'top-end',
                    icon: 'error',
                    title: 'form conatins error',
                    showConfirmButton: false,
                    timer: 1500
                })
            }
        });
    }


    function add_new_checkout_address() {
        document.getElementById('add_new_checkout_address_form').style.display = 'block'
        document.getElementById('add_new_checkout_address_btn_link').style.display = 'none'
    }
    function add_new_checkout_address_btn_link_cancel() {
        document.getElementById('add_new_checkout_address_form').style.display = 'none'
        document.getElementById('add_new_checkout_address_btn_link').style.display = 'block'
    }

    function add_checkout_new_address_form() {
        var user_id = $('#user_id').val();
        var name = $('#address_name').val();
        var phone_no = $('#address_phone_no').val();
        var pincode = $('#address_pincode').val();
        var locality = $('#address_locality').val();
        var address = $('#address_address').val();
        var city_district_town = $('#address_city_district_town').val();
        var state = $('#address_state option:selected').val();
        var landmark = $('#address_landmark').val();
        var alt_phone_no = $('#address_alt_phone_no').val();
        var address_type = $(".edit_addresstype:checked").val();
        $.ajax({
            type: "POST",
            url: "{% url 'cart:add_checkout_new_address_form' %}",
            data: {
                user_id,
                name,
                phone_no,
                pincode,
                locality,
                address,
                city_district_town,
                state,
                landmark,
                alt_phone_no,
                address_type,
                csrfmiddlewaretoken: '{{ csrf_token }}',
                dataType: "json",

            },
            beforeSend: function () {
                document.getElementById('submit_checkout_add_address').setAttribute('disabled', '')
            },
            success: function (res) {
                document.getElementById('submit_checkout_add_address').removeAttribute('disabled')
                $('#checkout_address').html(res.template);
                console.log('success')
                Swal.fire({
                    position: 'top-end',
                    icon: 'success',
                    title: 'Your address has been saved',
                    showConfirmButton: false,
                    timer: 1500
                })
            },
            failure: function () {
                Swal.fire({
                    position: 'top-end',
                    icon: 'error',
                    title: 'form conatins error',
                    showConfirmButton: false,
                    timer: 1500
                })
            }
        });
    }


    function delete_checkout_items(cart_id) {
        console.log(cart_id)
        $.ajax({
            type: "POST",
            url: "{% url 'cart:delete_checkout_items' %}",
            data: {
                cart_id,
                csrfmiddlewaretoken: '{{ csrf_token }}',
                dataType: "json",
            },
            success: function (res) {
                $("#checkout_items_list_order_summry #checkout_items_list_order_summry_items-" + cart_id).remove();
                Swal.fire({
                    icon: 'success',
                    title: 'Delete Success fully',
                    showConfirmButton: false,
                    timer: 1500
                })
                $('.cart-count-lenght').text(res.length_product);
                $('.totel-price').text(res.totel_price);
                $('.Totel_unit_price').text(res.Totel_unit_price);
                $('.totel-savings').text(res.savings);
            },
            failure: function () {
                Swal.fire({
                    icon: 'error',
                    title: 'Sorry ... Delete Not Success fully,something error',
                    showConfirmButton: false,
                    timer: 1500
                })
            }
        });
    }




    function order_submit() {
        var address_id = $(".check_checkout_address:checked").val();
        Swal.fire({
            title: 'Are you sure?',
            text: "You Continue Payment procedure",
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes'
        }).then((result) => {
            if (result.isConfirmed) {

                $.ajax({
                    type: "POST",
                    url: "{% url 'cart:continue_order' %}",
                    data: {
                        address_id,
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                        dataType: "json",
                    },
                    beforeSend: function () {

                    },
                    success: function (res) {
                        $('#totel_payment_price').text(res.totel_payment_price);
                        $('#totel_items_checkout_responce').text(res.totel_items_checkout);
                        document.getElementById('login_Change').style.display = 'none';
                        document.getElementById('order_summery_check').style.display = 'block';
                        document.getElementById('check_checkout_address_check_Change').style.display = 'none';
                        document.getElementById('payment_methods').style.display = 'block'
                        document.getElementById('checkout_items_list_order_summry').style.display = 'none'
                        document.getElementById('order_summery_check').style.display = 'block'
                        document.getElementById('totel_items_checkout_responce_p').style.display = 'block'
                    },
                    failure: function () {
                        Swal.fire({
                            icon: 'error',
                            title: 'Sorry ... Delete Not Success fully,something error',
                            showConfirmButton: false,
                            timer: 1500
                        })
                    }
                });
            }
        })
    }

    function Coupon() {
        document.getElementById('Coupon').style.display = 'block';
        $('#Coupon_submit').on('submit', function (e) {
            var Couponcode = $('#Couponcode').val();
            e.preventDefault();
            $.ajax({
                type: "POST",
                url: "{% url 'cart:coupon' %}",
                data: {
                    Couponcode,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    dataType: "json",
                },
                beforeSend: function () {
                    // $('#coupensubmit').setAttribute('disabled', '')
                },
                success: function (res) {
                    if (res.data) {
                        $('#all-checkout-totel-and-order-totel').html(res.template)
                        document.getElementById('coupen_disable').style.display = 'none';
                        let timerInterval
                        Swal.fire({
                            title: 'Auto close alert!',
                            html: 'I will close in <b></b> milliseconds.',
                            timer: 2000,
                            timerProgressBar: true,
                            didOpen: () => {
                                Swal.showLoading()
                                const b = Swal.getHtmlContainer().querySelector('b')
                                timerInterval = setInterval(() => {
                                    b.textContent = Swal.getTimerLeft()
                                }, 100)
                            },
                            willClose: () => {
                                clearInterval(timerInterval)
                            }
                        }).then((result) => {
                            /* Read more about handling dismissals below */
                            if (result.dismiss === Swal.DismissReason.timer) {
                                window.location.href = "{% url 'cart:checkout' %}"
                                console.log('I was closed by the timer')
                                Swal.fire({
                                    position: 'top-end',
                                    icon: 'success',
                                    title: 'coupen added',
                                    showConfirmButton: false,
                                    timer: 1500
                                })
                            }
                        })

                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: res.msg,
                            showConfirmButton: false,
                            timer: 1500
                        })
                    }

                },
            });
        });

    }

    function cash_on_delivery() {
        document.getElementById('cash_on_delivery_method_verify').style.display = 'block'
        $.ajax({
            type: "POST",
            url: "{% url 'payment:cash_on_delivery_code_genarator' %}",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                dataType: "json",
            },
            beforeSend: function () {

            },
            success: function (res) {
                $("#cash_on_delivery_code_genarator").text(res.text_instence)
                $("#cash_on_delivery_code_genarator_input").val(res.text_instence)

                document.getElementById('cash_on_delivery_id').setAttribute('disabled', '')
            },
            failure: function () {

            }
        });
    }

    function refresh_cash_on_delivery_code_genarator() {
        $.ajax({
            type: "POST",
            url: "{% url 'payment:cash_on_delivery_code_genarator' %}",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                dataType: "json",
            },
            beforeSend: function () {

            },
            success: function (res) {
                $("#cash_on_delivery_code_genarator").text(res.text_instence)
                $("#cash_on_delivery_code_genarator_input").val(res.text_instence)

            },
            failure: function () {
            }
        });
    }

    function CONFRIME_ORDER() {
        var try_code = $("#try_code").val();
        var test_code = $("#cash_on_delivery_code_genarator_input").val();
        if (try_code === test_code) {
            location.href = '{% url "payment:cash_on_delivery_order_confrim" %}';
        } else {
            $("#error_massage").text('Incurrect text entered. Please try again.');
            // messages timeout for 10 sec 
            setTimeout(function () {
                $('#error_massage').fadeOut('slow');
            }, 4000); // <-- time in milliseconds, 1000 =  1 sec

        }
    }




</script>


{% endblock %}